
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Plus+Jakarta+Sans%3Awght%40400%3B500%3B700%3B800"
    />
    <title>Stitch Design</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <style>
      /* Global font family */
      body {
        font-family: "Plus Jakarta Sans", "Noto Sans", sans-serif;
      }

      /* Custom styles for the loading spinner */
      .loader {
        border: 4px solid #F5F5F5; /* Light grey */
        border-top: 4px solid #333333; /* Dark grey */
        border-radius: 50%;
        width: 24px;
        height: 24px;
        animation: spin 2s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Custom style for selected radio button label */
      .radio-selected {
        background-color: #000000; /* Pure Black */
        border-color: #000000; /* Match border to background */
      }
      .radio-selected p { /* Target text inside selected radio label */
        color: #FFFFFF; /* White text */
      }
      /* Hover for selected radio button: Lower opacity, text remains white */
      .radio-selected:hover {
        opacity: 0.8; /* Lower opacity on hover */
        /* Ensure background and border remain black */
        background-color: #000000;
        border-color: #000000;
      }
      .radio-selected:hover p {
        color: #FFFFFF; /* Text remains white on hover */
      }

      /* Custom style for selected vibe option */
      .vibe-selected {
        background-color: #000000; /* Pure Black for selected vibe */
        color: #FFFFFF; /* White text for contrast */
      }
      /* Hover for selected vibe option: Lower opacity, text remains white */
      .vibe-selected:hover {
        opacity: 0.8; /* Lower opacity on hover */
        /* Ensure background remains black */
        background-color: #000000;
        color: #FFFFFF; /* Text remains white on hover */
      }

      /* Hover for unselected radio/visibility/accepting-requests labels */
      /* This ensures the text inside the <p> tag also changes color on hover */
      .visibility-label:hover p,
      .accepting-requests-label:hover p {
        color: #FFFFFF; /* Text becomes white on hover */
      }

      /* Style for the static image */
      .static-image-placeholder {
        height: 200px; /* Adjust height as needed */
        width: 100%;
        border-radius: 0.75rem; /* rounded-xl */
        object-fit: cover; /* Ensure image covers the area */
      }

      /* Hide the actual radio input circles */
      .visibility-label input[type="radio"],
      .accepting-requests-label input[type="radio"] {
        appearance: none;
        -webkit-appearance: none;
        width: 0; /* Make it effectively invisible */
        height: 0; /* Make it effectively invisible */
        margin: 0; /* Remove any default margin */
        padding: 0; /* Remove any default padding */
        border: none; /* Remove any default border */
        position: absolute; /* Take it out of flow */
        clip: rect(0 0 0 0); /* Clip it to be completely hidden */
        overflow: hidden; /* Hide overflow */
      }
    </style>
  </head>
  <body>
    <div
      class="relative flex size-full min-h-screen flex-col bg-[#FFFFFF] justify-between group/design-root overflow-x-hidden"
    >
      <div>
        <!-- Header Section -->
        <div class="flex items-center bg-[#FFFFFF] p-4 pb-2 justify-between max-w-[480px] mx-auto">
          <div class="text-[#1A1A1A] flex size-12 shrink-0 items-center" data-icon="X" data-size="24px" data-weight="regular">
            <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" fill="currentColor" viewBox="0 0 256 256">
              <path
                d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"
              ></path>
            </svg>
          </div>
          <h2 class="text-[#1A1A1A] text-lg font-bold leading-tight tracking-[-0.015em] flex-1 text-center pr-12">New activity</h2>
        </div>

        <!-- Activity Input -->
        <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3 mx-auto">
          <label class="flex flex-col min-w-40 flex-1">
            <input
              id="activity-input"
              placeholder="What do you want to do? ðŸ‘€"
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#1A1A1A] focus:outline-0 focus:ring-0 border-none bg-[#F5F5F5] focus:border-none h-14 placeholder:text-[#888888] p-4 text-base font-normal leading-normal"
              value=""
            />
          </label>
        </div>

        <!-- When Section -->
        <h3 class="text-[#1A1A1A] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4 max-w-[480px] mx-auto">When</h3>
        <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3 mx-auto">
          <label class="flex flex-col min-w-40 flex-1">
            <input
              type="datetime-local"
              id="datetime-input"
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#1A1A1A] focus:outline-0 focus:ring-0 border-none bg-[#F5F5F5] focus:border-none h-14 placeholder:text-[#888888] p-4 text-base font-normal leading-normal"
            />
          </label>
        </div>
        <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3 mx-auto">
          <label class="flex flex-col min-w-40 flex-1">
            <input
              type="text"
              id="duration-input"
              placeholder="Duration (e.g., 2 hours, 30 mins)"
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#1A1A1A] focus:outline-0 focus:ring-0 border-none bg-[#F5F5F5] focus:border-none h-14 placeholder:text-[#888888] p-4 text-base font-normal leading-normal"
              value=""
            />
          </label>
        </div>

        <!-- Description Section (Moved Up) -->
        <h3 class="text-[#1A1A1A] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4 max-w-[480px] mx-auto">Description</h3>
        <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3 mx-auto">
          <label class="flex flex-col min-w-40 flex-1">
            <textarea
              id="description-textarea"
              placeholder="Add a description"
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#1A1A1A] focus:outline-0 focus:ring-0 border-none bg-[#F5F5F5] focus:border-none min-h-36 placeholder:text-[#888888] p-4 text-base font-normal leading-normal"
            ></textarea>
          </label>
        </div>

        <!-- How many Section -->
        <h3 class="text-[#1A1A1A] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4 max-w-[480px] mx-auto">How many</h3>
        <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3 mx-auto">
          <label class="flex flex-col min-w-40 flex-1">
            <input
              type="number"
              id="max-participants-input"
              placeholder="Max number of participants"
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#1A1A1A] focus:outline-0 focus:ring-0 border-none bg-[#F5F5F5] focus:border-none h-14 placeholder:text-[#888888] p-4 text-base font-normal leading-normal"
              value=""
              min="1"
            />
          </label>
        </div>

        <!-- Where Section -->
        <h3 class="text-[#1A1A1A] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4 max-w-[480px] mx-auto">Where</h3>
        <div class="flex max-w-[480px] flex-wrap items-end gap-4 px-4 py-3 mx-auto">
          <label class="flex flex-col min-w-40 flex-1">
            <input
              type="text"
              id="location-input"
              placeholder="Location"
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-xl text-[#1A1A1A] focus:outline-0 focus:ring-0 border-none bg-[#F5F5F5] focus:border-none h-14 placeholder:text-[#888888] p-4 text-base font-normal leading-normal"
              value=""
            />
          </label>
        </div>
        <!-- San Francisco Map Image -->
        <div class="flex px-4 py-3 max-w-[480px] mx-auto">
          <img
            class="static-image-placeholder"
            src="https://placehold.co/600x400/F5F5F5/888888?text=San+Francisco+Map"
            alt="Map of San Francisco"
          />
        </div>


        <!-- Vibe Section -->
        <h3 class="text-[#1A1A1A] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4 max-w-[480px] mx-auto">Vibe</h3>
        <div class="flex gap-3 p-3 flex-wrap pr-4 max-w-[480px] mx-auto" id="vibe-options-container">
          <div class="flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full bg-[#F5F5F5] pl-4 pr-4 vibe-option cursor-pointer transition-all duration-200 hover:scale-105 active:scale-95 hover:bg-[#1A1A1A] hover:text-[#FFFFFF]" data-vibe="Casual">
            <p class="text-[#1A1A1A] text-sm font-medium leading-normal">Casual</p>
          </div>
          <div class="flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full bg-[#F5F5F5] pl-4 pr-4 vibe-option cursor-pointer transition-all duration-200 hover:scale-105 active:scale-95 hover:bg-[#1A1A1A] hover:text-[#FFFFFF]" data-vibe="Fun">
            <p class="text-[#1A1A1A] text-sm font-medium leading-normal">Fun</p>
          </div>
          <div class="flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full bg-[#F5F5F5] pl-4 pr-4 vibe-option cursor-pointer transition-all duration-200 hover:scale-105 active:scale-95 hover:bg-[#1A1A1A] hover:text-[#FFFFFF]" data-vibe="Relaxed">
            <p class="text-[#1A1A1A] text-sm font-medium leading-normal">Relaxed</p>
          </div>
          <div class="flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full bg-[#F5F5F5] pl-4 pr-4 vibe-option cursor-pointer transition-all duration-200 hover:scale-105 active:scale-95 hover:bg-[#1A1A1A] hover:text-[#FFFFFF]" data-vibe="Adventurous">
            <p class="text-[#1A1A1A] text-sm font-medium leading-normal">Adventurous</p>
          </div>
          <div class="flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full bg-[#F5F5F5] pl-4 pr-4 vibe-option cursor-pointer transition-all duration-200 hover:scale-105 active:scale-95 hover:bg-[#1A1A1A] hover:text-[#FFFFFF]" data-vibe="Social">
            <p class="text-[#1A1A1A] text-sm font-medium leading-normal">Social</p>
          </div>
        </div>
        <div class="flex px-4 py-3 max-w-[480px] mx-auto">
          <button
            id="suggest-vibes-button"
            class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#F5F5F5] text-[#1A1A1A] text-sm font-bold leading-normal tracking-[0.015em] transition-all duration-200 hover:scale-105 active:scale-95 hover:bg-[#1A1A1A] hover:text-[#FFFFFF]"
          >
            <span class="truncate">Suggest More Vibes (AI)</span>
          </button>
        </div>

        <!-- Images Section -->
        <h3 class="text-[#1A1A1A] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4 max-w-[480px] mx-auto">Images</h3>
        <div class="flex flex-col p-4 max-w-[480px] mx-auto">
          <!-- image-preview div is now here and hidden by default -->
          <div
            id="image-preview"
            class="w-full bg-center bg-no-repeat aspect-video bg-cover rounded-xl object-cover flex items-center justify-center mb-6 hidden"
            style='background-image: none; background-color: #F5F5F5;'
          >
            <!-- Loading spinner will be inserted here -->
          </div>

          <div class="flex flex-col items-center gap-6 rounded-xl border-2 border-dashed border-[#CCCCCC] px-6 py-14">
            <div class="flex max-w-[480px] flex-col items-center gap-2">
              <p class="text-[#1A1A1A] text-lg font-bold leading-tight tracking-[-0.015em] max-w-[480px] text-center">Upload Image</p>
              <p class="text-[#1A1A1A] text-sm font-normal leading-normal max-w-[480px] text-center">Tap to upload an image for your activity</p>
            </div>
            <input type="file" id="image-upload" accept="image/*" class="hidden" />
            <button
              id="upload-button"
              class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 px-4 bg-[#F5F5F5] text-[#1A1A1A] text-sm font-bold leading-normal tracking-[0.015em] transition-all duration-200 hover:scale-105 active:scale-95 hover:bg-[#1A1A1A] hover:text-[#FFFFFF]"
            >
              <span class="truncate">Upload</span>
            </button>
          </div>
        </div>
        <p class="text-[#888888] text-sm font-normal leading-normal pb-3 pt-1 px-4 max-w-[480px] mx-auto">If no images are provided, an AI-generated image based on the description will be displayed.</p>

        <!-- Visibility Section -->
        <h3 class="text-[#1A1A1A] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4 max-w-[480px] mx-auto">Visibility</h3>
        <div class="flex flex-col gap-3 p-4 max-w-[480px] mx-auto">
          <label class="flex items-center gap-4 rounded-xl border border-solid border-[#CCCCCC] p-[15px] flex-row-reverse visibility-label cursor-pointer transition-all duration-200 hover:bg-[#1A1A1A] active:scale-[0.98]">
            <input
              type="radio"
              class="h-5 w-5 border-2 border-[#CCCCCC] bg-transparent text-transparent focus:outline-none focus:ring-0 focus:ring-offset-0"
              name="visibility"
              value="public"
              checked
            />
            <div class="flex grow flex-col"><p class="text-[#1A1A1A] text-sm font-medium leading-normal">Public</p></div>
          </label>
          <label class="flex items-center gap-4 rounded-xl border border-solid border-[#CCCCCC] p-[15px] flex-row-reverse visibility-label cursor-pointer transition-all duration-200 hover:bg-[#1A1A1A] active:scale-[0.98]">
            <input
              type="radio"
              class="h-5 w-5 border-2 border-[#CCCCCC] bg-transparent text-transparent focus:outline-none focus:ring-0 focus:ring-offset-0"
              name="visibility"
              value="friends"
            />
            <div class="flex grow flex-col"><p class="text-[#1A1A1A] text-sm font-medium leading-normal">Friends</p></div>
          </label>
          <label class="flex items-center gap-4 rounded-xl border border-solid border-[#CCCCCC] p-[15px] flex-row-reverse visibility-label cursor-pointer transition-all duration-200 hover:bg-[#1A1A1A] active:scale-[0.98]">
            <input
              type="radio"
              class="h-5 w-5 border-2 border-[#CCCCCC] bg-transparent text-transparent focus:outline-none focus:ring-0 focus:ring-offset-0"
              name="visibility"
              value="custom"
            />
            <div class="flex grow flex-col"><p class="text-[#1A1A1A] text-sm font-medium leading-normal">Custom</p></div>
          </label>
        </div>

        <!-- Accepting Requests Section -->
        <h3 class="text-[#1A1A1A] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4 max-w-[480px] mx-auto">Accepting requests</h3>
        <div class="flex flex-col gap-3 p-4 max-w-[480px] mx-auto">
          <label class="flex items-center gap-4 rounded-xl border border-solid border-[#CCCCCC] p-[15px] flex-row-reverse accepting-requests-label cursor-pointer transition-all duration-200 hover:bg-[#1A1A1A] active:scale-[0.98]">
            <input
              type="radio"
              class="h-5 w-5 border-2 border-[#CCCCCC] bg-transparent text-transparent focus:outline-none focus:ring-0 focus:ring-offset-0"
              name="accepting-requests"
              value="manually"
              checked
            />
            <div class="flex grow flex-col"><p class="text-[#1A1A1A] text-sm font-medium leading-normal">Manually</p></div>
          </label>
          <label id="auto-accept-option-label" class="flex items-center gap-4 rounded-xl border border-solid border-[#CCCCCC] p-[15px] flex-row-reverse accepting-requests-label cursor-pointer transition-all duration-200 hover:bg-[#1A1A1A] active:scale-[0.98] hidden">
            <input
              type="radio"
              class="h-5 w-5 border-2 border-[#CCCCCC] bg-transparent text-transparent focus:outline-none focus:ring-0 focus:ring-offset-0"
              name="accepting-requests"
              value="auto-accept"
            />
            <div class="flex grow flex-col"><p class="text-[#1A1A1A] text-sm font-medium leading-normal" id="auto-accept-text">Auto-accept first 5 people</p></div>
          </label>
        </div>
      </div>
      <!-- Post Button Section -->
      <div>
        <div class="flex px-4 py-3 max-w-[480px] mx-auto">
          <button
            id="post-button"
            class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-12 px-5 flex-1 bg-[#000000] text-[#FFFFFF] text-base font-bold leading-normal tracking-[0.015em] transition-all duration-200 hover:scale-105 active:scale-95 hover:bg-[#000000] hover:opacity-80 hover:text-[#FFFFFF]"
          >
            <span class="truncate">Post</span>
          </button>
        </div>
        <div class="h-5 bg-[#FFFFFF]"></div>
      </div>
    </div>

    <script>
      // Get references to DOM elements
      const imageUpload = document.getElementById("image-upload");
      const uploadButton = document.getElementById("upload-button");
      const imagePreview = document.getElementById("image-preview");
      const descriptionTextarea = document.getElementById("description-textarea");
      const postButton = document.getElementById("post-button");
      const activityInput = document.getElementById("activity-input");
      const datetimeInput = document.getElementById("datetime-input");
      const durationInput = document.getElementById("duration-input");
      const locationInput = document.getElementById("location-input");
      const maxParticipantsInput = document.getElementById("max-participants-input");
      const autoAcceptText = document.getElementById("auto-accept-text");
      const autoAcceptOptionLabel = document.getElementById("auto-accept-option-label"); // New ID
      const vibeOptionsContainer = document.getElementById("vibe-options-container");
      const suggestVibesButton = document.getElementById("suggest-vibes-button");

      // Function to update radio button styling (Visibility & Accepting Requests)
      function updateRadioStyling(groupName) {
        const radioButtons = document.querySelectorAll(`input[name="${groupName}"]`);
        radioButtons.forEach(radio => {
          const label = radio.closest('label'); // Get the parent label
          if (radio.checked) {
            label.classList.add('radio-selected');
          } else {
            label.classList.remove('radio-selected');
          }
        });
      }

      // Function to update vibe option styling
      function setupVibeOptionListeners() {
        const vibeOptions = document.querySelectorAll('.vibe-option');
        vibeOptions.forEach(option => {
          // Remove existing listener to prevent duplicates
          option.removeEventListener('click', toggleVibeSelection);
          // Add new listener
          option.addEventListener('click', toggleVibeSelection);
        });
      }

      function toggleVibeSelection(event) {
        event.currentTarget.classList.toggle('vibe-selected');
      }

      // Initial styling for radio buttons and vibe options on load
      window.addEventListener('load', () => {
        updateRadioStyling('visibility');
        updateRadioStyling('accepting-requests');
        setupVibeOptionListeners(); // Initialize vibe option click listeners
        updateAutoAcceptText(); // Set initial auto-accept text
      });

      // Event listeners for radio button changes
      document.querySelectorAll('input[name="visibility"]').forEach(radio => {
        radio.addEventListener('change', () => updateRadioStyling('visibility'));
      });

      document.querySelectorAll('input[name="accepting-requests"]').forEach(radio => {
        radio.addEventListener('change', () => updateRadioStyling('accepting-requests'));
      });

      // Update auto-accept text based on max participants input and toggle visibility
      maxParticipantsInput.addEventListener('input', updateAutoAcceptText);

      function updateAutoAcceptText() {
        const maxParticipants = parseInt(maxParticipantsInput.value);
        if (!isNaN(maxParticipants) && maxParticipants > 0) {
          autoAcceptText.textContent = `Auto-accept first ${maxParticipants} people`;
          autoAcceptOptionLabel.classList.remove('hidden'); // Show the option
        } else {
          autoAcceptText.textContent = `Auto-accept first 5 people`; // Default if invalid
          autoAcceptOptionLabel.classList.add('hidden'); // Hide the option
          // If hidden, ensure it's not checked
          const autoAcceptRadio = autoAcceptOptionLabel.querySelector('input[type="radio"]');
          if (autoAcceptRadio && autoAcceptRadio.checked) {
            document.querySelector('input[name="accepting-requests"][value="manually"]').checked = true;
            updateRadioStyling('accepting-requests');
          }
        }
      }

      // Event listener for the upload button to trigger the file input
      uploadButton.addEventListener("click", () => {
        imageUpload.click();
      });

      // Event listener for when a file is selected
      imageUpload.addEventListener("change", (event) => {
        const file = event.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            // Set the background image of the preview div to the uploaded image
            imagePreview.style.backgroundImage = `url('${e.target.result}')`;
            imagePreview.innerHTML = ""; // Clear any loading spinners
            imagePreview.classList.remove('hidden'); // Show the image preview
          };
          reader.readAsDataURL(file);
        }
      });

      // Event listener for AI vibe suggestion button
      suggestVibesButton.addEventListener('click', async () => {
        const description = descriptionTextarea.value.trim();
        const activity = activityInput.value.trim();

        if (description === "" && activity === "") {
          console.log("Please provide a description or activity to suggest vibes.");
          return;
        }

        suggestVibesButton.textContent = "Suggesting...";
        suggestVibesButton.disabled = true;

        try {
          const prompt = `Based on the following activity: "${activity}" and description: "${description}", suggest 3-5 unique and relevant vibe tags. Provide them as a JSON array of strings, for example: ["Energetic", "Chill", "Creative"]. Do not include any other text or formatting.`;
          const payload = {
            contents: [{ role: "user", parts: [{ text: prompt }] }],
            generationConfig: {
              responseMimeType: "application/json",
              responseSchema: {
                type: "ARRAY",
                items: { "type": "STRING" }
              }
            }
          };
          const apiKey = ""; // Canvas will provide this API key
          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

          const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload),
          });

          const result = await response.json();

          if (result.candidates && result.candidates.length > 0 && result.candidates[0].content && result.candidates[0].content.parts && result.candidates[0].content.parts.length > 0) {
            const jsonString = result.candidates[0].content.parts[0].text;
            const newVibes = JSON.parse(jsonString);

            newVibes.forEach(vibe => {
              // Check if vibe already exists to prevent duplicates
              const existingVibes = Array.from(document.querySelectorAll('.vibe-option p')).map(p => p.textContent.trim());
              if (!existingVibes.includes(vibe)) {
                const newVibeDiv = document.createElement('div');
                newVibeDiv.className = "flex h-8 shrink-0 items-center justify-center gap-x-2 rounded-full bg-[#F5F5F5] pl-4 pr-4 vibe-option cursor-pointer transition-all duration-200 hover:scale-105 active:scale-95 hover:bg-[#1A1A1A] hover:text-[#FFFFFF]";
                newVibeDiv.dataset.vibe = vibe;
                newVibeDiv.innerHTML = `<p class="text-[#1A1A1A] text-sm font-medium leading-normal">${vibe}</p>`;
                vibeOptionsContainer.appendChild(newVibeDiv);
              }
            });
            setupVibeOptionListeners(); // Re-attach listeners for new elements
          } else {
            console.error("Failed to generate vibes: Unexpected response structure.");
          }
        } catch (error) {
          console.error("Error generating vibes:", error);
        } finally {
          suggestVibesButton.textContent = "Suggest More Vibes (AI)";
          suggestVibesButton.disabled = false;
        }
      });


      // Event listener for the post button
      postButton.addEventListener("click", async () => {
        const description = descriptionTextarea.value;
        const activity = activityInput.value;

        // If no image is uploaded and there's a description, generate an AI image
        if (!imageUpload.files[0] && description.trim() !== "") {
          imagePreview.innerHTML = '<div class="loader"></div>'; // Show loading spinner
          imagePreview.style.backgroundImage = 'none'; // Clear any previous image
          imagePreview.classList.remove('hidden'); // Show the image preview

          try {
            // Call the Imagen API to generate an image based on the description
            const prompt = `Generate an image for an activity post with the following description: "${description}". The activity is: "${activity}".`;
            const payload = { instances: { prompt: prompt }, parameters: { sampleCount: 1 } };
            const apiKey = ""; // Canvas will provide this API key
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-3.0-generate-002:predict?key=${apiKey}`;

            const response = await fetch(apiUrl, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            });

            const result = await response.json();

            if (result.predictions && result.predictions.length > 0 && result.predictions[0].bytesBase64Encoded) {
              const imageUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
              imagePreview.style.backgroundImage = `url('${imageUrl}')`;
              imagePreview.innerHTML = ""; // Remove loading spinner
            } else {
              console.error("Failed to generate image: No predictions found or missing base64 data.");
              imagePreview.innerHTML = ""; // Remove loading spinner
              imagePreview.style.backgroundImage = 'url("https://placehold.co/600x400/F5F5F5/888888?text=Image+Generation+Failed")'; // Show error placeholder
            }
          } catch (error) {
            console.error("Error generating image:", error);
            imagePreview.innerHTML = ""; // Remove loading spinner
            imagePreview.style.backgroundImage = 'url("https://placehold.co/600x400/F5F5F5/888888?text=Image+Generation+Failed")'; // Show error placeholder
          }
        } else if (!imageUpload.files[0]) {
          // If no image and no description, hide the image preview
          imagePreview.classList.add('hidden');
          imagePreview.style.backgroundImage = 'none'; // Ensure background image is cleared
          imagePreview.style.backgroundColor = '#F5F5F5'; // Keep background color for consistency if it becomes visible later
          imagePreview.innerHTML = "";
        }

        // Here you would typically gather all form data and send it to your backend
        const selectedVibes = Array.from(document.querySelectorAll('.vibe-option.vibe-selected p')).map(el => el.textContent.trim());

        const activityData = {
          what: activityInput.value,
          when: datetimeInput.value,
          duration: durationInput.value,
          where: locationInput.value,
          who: maxParticipantsInput.value,
          vibe: selectedVibes, // Now correctly captures selected vibes
          description: descriptionTextarea.value,
          visibility: document.querySelector('input[name="visibility"]:checked').value,
          acceptingRequests: document.querySelector('input[name="accepting-requests"]:checked').value,
          // You would also include the image URL if one was uploaded or generated
          imageUrl: imagePreview.style.backgroundImage.replace(/url\(['"]?(.*?)['"]?\)/, '$1')
        };

        console.log("Activity Data:", activityData);
        // In a real app, you would send this data to a server
        // Example: fetch('/api/post-activity', { method: 'POST', body: JSON.stringify(activityData) });
      });
    </script>
  </body>
</html>
